<project name="platinum-modules" default="doModules" basedir=".">

    <import file="build.xml"/>

    <target name="module-check">

        <property name="sourcepath" value="${project.sourcedir}/${name}" />
        <available property="module.exists" file="${sourcepath}/build.xml"/>

        <!-- component info  -->
        <echo message="=============================================================="/>
        <echo message="=== Build Component: ${name}: ${target}"/>
        <echo message="=============================================================="/>
        <echo message=" project root         = ${project.root}"/>
        <echo message=" project dist         = ${project.dist}"/>
        <echo message=" project sourceroot   = ${project.sourcedir}"/>
        <echo message=" component name       = ${name}"/>
        <echo message=" component subpath   = ${subpath}"/>
        <echo message=" component sourcepath = ${sourcepath}"/>

    </target>

    <!-- 
        Build Component
            name   : Component Name 
            target : Target component (directory) 
      -->
    <target name="module-build" depends="module-check">

        <fail unless="module.exists" 
              message="*** Component: ${name} at ${sourcepath} is missing or scm checkout went wrong (missing build.xml file ?)" />

        <!-- default target: can be overriden by previous target-->
        <property name="target" value="dist-install"/>

        <ant antfile="build.xml" 
            dir="${sourcepath}" 
            target="${target}">
        </ant>

    </target>

    <target name="doModules" depends="platinum-all"/>

    <target name="doModules-test" depends="platinum-modules-test"/>

    <target name="platinum-modules-test" depends="init">

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    </target>

    <target name="platinum-all" depends="init,platinum-core,platinum-vbrowser,platinum-vbrowser-viewers">
    </target>

    <target name="platinum-auxlibs" depends="init">
        <!-- current library dependencies are in modules lib directory --> 
    </target> 

    <target name="platinum-core" depends="init,platinum-auxlibs">

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk.web"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>
	</target>
    	
    <target name="platinum-vbrowser-vrs" depends="init,platinum-core">

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk.vbrowser.vrs"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    </target>

    <!--
      ===========================================
                   Non VBrowser Util modules 
      ===========================================
      --> 
            	
	<target name="platinum-util-vterm" depends="platinum-core">

	    <antcall target="module-build">
	        <param name="name" value="nl.esciencecenter.ptk.util.vterm"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    </target>
	
    <!--
      ===========================================
                    VBrowser (UI) Modules
      ===========================================
      --> 

    <target name="platinum-vbrowser" depends="platinum-core,platinum-vbrowser-vrs">

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk.ui"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    	<!-- 
    	     Note: VBrowser viewers are build before VBrowser core component!
    	  --> 
        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk.vbrowser.viewers"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

        <antcall target="module-build">
            <param name="name" value="nl.esciencecenter.ptk.vbrowser.ui"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    </target>
        
	<!-- seperate Viewer Modules --> 
        	
	<target name="platinum-vbrowser-viewers" depends="platinum-core,platinum-vbrowser-vrs">
		<!-- external plugins --> 
	</target>
        	 

    <!-- =================================================================== -->
    <!--   Platinum (LaTeX) Documentation                                    -->
    <!-- =================================================================== -->

    <!-- 
         Conditional target: latexdocs can only be created on Linux
      -->

    <target name="check-build-userguide">
        <!-- set if not set -->
        <property name=" " value="yes" />

        <condition property="do.build.doc.userguide">
            <and>
                <!-- yes/true strings: -->
                <istrue value="${project.build.doc.userguide}"/>
                <not>
                    <os family="windows" />
                </not>
            </and>
        </condition>

        <echo message=" project.build.doc.userguide =${project.build.doc.userguide} "/>
        <echo message=" do.build.doc.userguide      =${do.build.doc.userguide} "/>

    </target>

    <target name="platinum-doc.userguide" if="do.build.doc.userguide" depends="platinum-core,check-build-userguide">

        <antcall target="module-build" >
            <param name="name" value="doc.userguide"/>
            <param name="version" value=""/>
            <param name="subpath" value=""/>
        </antcall>

    </target>


</project>
